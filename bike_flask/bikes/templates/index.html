<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Dashboard - Brand</title>
    <base href="/bikes/static/">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">

    <script src="assets/js/jquery-3.4.1.min.js"></script>

    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyChOgcySVgoWybwFWZ8KTmOC0XBDHkgdnY">
    </script>

    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/chart.min.js"></script>
    <script src="assets/js/bs-init.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.js"></script>
    <script src="assets/js/theme.js"></script>
    <!--Load the API from the specified URL
    * The async attribute allows the browser to render the page while the API loads
    * The key parameter will contain your own API key (which is not needed for this tutorial)
    * The callback parameter executes the initMap() function
    -->


    <script type="text/javascript">
        // Initialize and add the map
        $(function () {

            $.fn.create_marker = function (lat, lng, name, map) {

                var image = {
                    url: 'https://developers.google.com/maps/documentation/javascript/examples/full/images/parking_lot_maps.png',
                    {#url:'http://image.flaticon.com/icons/svg/252/252025.svg',#}
                    // This marker is 20 pixels wide by 32 pixels high.
                    size: new google.maps.Size(30, 32),
                    // The origin for this image is (0, 0).
                    origin: new google.maps.Point(0, 0),
                    // The anchor for this image is the base of the flagpole at (0, 32).
                    anchor: new google.maps.Point(0, 32)
                };

                var myLatlng = new google.maps.LatLng(lat, lng);
                var marker = new google.maps.Marker({
                    position: myLatlng,
                    map: map,
                    icon: image,
                    title: name
                    {#label: {#}
                        {#text: name,#}
                    {#    color: "#eb3a44",#}
                    {#    fontSize: "16px",#}
                    {#    fontWeight: "bold"#}



                });
                // To add the marker to the map, call setMap();
                marker.setMap(map);

                return marker;
            };

            $.ajax({
                type: "GET",
                url: "/data",
                datatype: "json",
                success: function (msg) {
                    initialize(msg);
                    add_marker_click();
                }
            });

            markers = [];

            /* call back to initialize the map and markers */
            function initialize(msg) {
                var map_marker = JSON.parse(msg);
                var center = new google.maps.LatLng(53.35, -6.27);
                var loc = {
                    zoom: 13,
                    center: center
                };

                var map = new google.maps.Map(document.getElementById("MAP_DIV"), loc);

                for (var i = 0; i < map_marker.length; i++) {
                    var lat = map_marker[i]['latitude'];
                    var lng = map_marker[i]['longitude'];
                    var name = map_marker[i]['name'];
                    var marker = $.fn.create_marker(lat, lng, name ,map);
                    {#var infowindow = new google.maps.InfoWindow({#}
                    {#        content: name#}
                    {#        });#}
                    //zoom in when mouse over the marker
                    marker.addListener('mouseover', function () {
                        /*setTimeout(function () {

                        }, 1000);*/
                        {#infowindow.open(map,this);#}
                        map.setZoom(16);
                        map.setCenter(this.position);

                    });

                    markers.push(marker);  /* store all the marker  */
                }
            }

            function get_station_info(lat, lng) {
                alert(lat + " " + lng);
                $.ajax({
                    type: "GET",
                    url: "/station",
                    data: {"lat": lat, "lng": lng},
                    datatype: "json",
                    success: function (msg) {
                        var bike_stands = JSON.parse(msg);
                        var avail_bikes = bike_stands['available_bikes'];
                        var avail_stands = bike_stands['available_bike_stands'];
                        var stands = bike_stands['bike_stands'];
                        $("#bikes_avail span").html(avail_bikes);
                        $("#stands_avail span").html(avail_stands);
                        $("#stands span").html(stands);
                    }
                });
            }// get_station_info

            function add_marker_click() {
                for (var j = 0; j < markers.length; j++) {
                    var marker = markers[j];
                    marker.addListener('click', function () {
                        /*
                        focus on the marker when user clicks
                         */
                        lat = this.position.lat();
                        lng = this.position.lng();
                        console.log(this.position.lat() + " " + this.position.lng());
                        get_station_info(lat, lng);
                    });
                }
            }


        });
    </script>


</head>

<body id="page-top">


<div id="wrapper">
    <div class="d-flex flex-column" id="content-wrapper">
        <div id="content">
            <nav class="navbar navbar-light navbar-expand bg-white shadow mb-4 topbar static-top">
                <div class="container-fluid">
                    <button class="btn btn-link d-md-none rounded-circle mr-3" id="sidebarToggleTop" type="button"><i
                            class="fas fa-bars"></i></button>
                </div>
            </nav>
            <div class="container-fluid">
                <div class="d-sm-flex justify-content-between align-items-center mb-4">
                    <h3 class="text-dark mb-0">Dashboard</h3><a class="btn btn-primary btn-sm d-none d-sm-inline-block"
                                                                role="button" href="#"><i
                        class="fas fa-download fa-sm text-white-50"></i>Button for freddie</a></div>
                <div class="row">
                    <div class="col-md-6 col-xl-3 mb-4">
                        <div class="card shadow border-left-primary py-2">
                            <div class="card-body">
                                <div class="row align-items-center no-gutters">
                                    <div class="col mr-2">
                                        <div class="text-uppercase text-primary font-weight-bold text-xs mb-1"><span>Bikes available</span>
                                        </div>
                                        <div id="bikes_avail" class="text-dark font-weight-bold h5 mb-0"><span>0</span>
                                        </div>

                                         <div class="text-uppercase text-primary font-weight-bold text-xs mb-1"><span>Stands available</span>
                                        </div>
                                        <div id="stands_avail" class="text-dark font-weight-bold h5 mb-0"><span>0</span>
                                        </div>

                                        <div class="text-uppercase text-primary font-weight-bold text-xs mb-1"><span>Bikes Stands</span>
                                        </div>
                                        <div id="stands" class="text-dark font-weight-bold h5 mb-0"><span>0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-7 col-xl-8">
                        <div class="card shadow mb-4">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="text-primary font-weight-bold m-0">MAP</h6>
                                <div class="dropdown no-arrow">
                                    <button class="btn btn-link btn-sm dropdown-toggle" data-toggle="dropdown"
                                            aria-expanded="false" type="button"><i
                                            class="fas fa-ellipsis-v text-gray-400"></i></button>
                                    <div class="dropdown-menu shadow dropdown-menu-right animated--fade-in"
                                         role="menu">
                                        <p class="text-center dropdown-header">dropdown header:</p><a
                                            class="dropdown-item" role="presentation" href="#">&nbsp;Action</a><a
                                            class="dropdown-item" role="presentation" href="#">&nbsp;Another action</a>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item" role="presentation" href="#">&nbsp;Something else
                                            here</a></div>
                                </div>
                            </div>


                            <div class="card-body" id="MAP_DIV" style="height: 403px;">jaja</div>

                            <div class="station_info">
                                <form action="#">


                                </form>


                            </div>


                        </div>
                    </div>
                    <div class="col-lg-5 col-xl-4">
                        <div class="card shadow mb-4">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="text-primary font-weight-bold m-0">WEATHER</h6>
                                <div class="dropdown no-arrow">
                                    <button class="btn btn-link btn-sm dropdown-toggle" data-toggle="dropdown"
                                            aria-expanded="false" type="button"><i
                                            class="fas fa-ellipsis-v text-gray-400"></i></button>
                                    <div class="dropdown-menu shadow dropdown-menu-right animated--fade-in"
                                         role="menu">
                                        <p class="text-center dropdown-header">dropdown header:</p><a
                                            class="dropdown-item" role="presentation" href="#">&nbsp;Action</a><a
                                            class="dropdown-item" role="presentation" href="#">&nbsp;Another action</a>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item" role="presentation" href="#">&nbsp;Something else
                                            here</a></div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="chart-area">
                                    <canvas data-bs-chart="{&quot;type&quot;:&quot;doughnut&quot;,&quot;data&quot;:{&quot;labels&quot;:[&quot;Direct&quot;,&quot;Social&quot;,&quot;Referral&quot;],&quot;datasets&quot;:[{&quot;label&quot;:&quot;&quot;,&quot;backgroundColor&quot;:[&quot;#4e73df&quot;,&quot;#1cc88a&quot;,&quot;#36b9cc&quot;],&quot;borderColor&quot;:[&quot;#ffffff&quot;,&quot;#ffffff&quot;,&quot;#ffffff&quot;],&quot;data&quot;:[&quot;50&quot;,&quot;30&quot;,&quot;15&quot;]}]},&quot;options&quot;:{&quot;maintainAspectRatio&quot;:false,&quot;legend&quot;:{&quot;display&quot;:false},&quot;title&quot;:{}}}"></canvas>
                                </div>
                                <div
                                        class="text-center small mt-4"><span class="mr-2"><i
                                        class="fas fa-circle text-primary"></i>&nbsp;Direct</span><span class="mr-2"><i
                                        class="fas fa-circle text-success"></i>&nbsp;Social</span><span class="mr-2"><i
                                        class="fas fa-circle text-info"></i>&nbsp;Refferal</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="row">
                            <div class="col-lg-6 mb-4">
                                <div class="card text-white bg-primary shadow">
                                    <div class="card-body">
                                        <p class="m-0">Primary</p>
                                        <p class="text-white-50 small m-0">I like pancake</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 mb-4">
                                <div class="card text-white bg-success shadow">
                                    <div class="card-body">
                                        <p class="m-0">HAboa -lue</p>
                                        <p class="text-white-50 small m-0">lalalla</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 mb-4">
                                <div class="card text-white bg-info shadow"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="bg-white sticky-footer">
            <div class="container my-auto">
                <div class="text-center my-auto copyright"><span>fuck u</span></div>
            </div>
        </footer>
    </div>
    <a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a></div>

</body>


</html>